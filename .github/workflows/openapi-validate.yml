name: openAPI linting test
on:
  workflow_dispatch:
    inputs:
      POC_ENV:
        description: 'The target build environment'
        required: true
        type: choice
        default: schemathesis
        options:
          - schemathesis
          - openapi-spec-validator
  workflow_call:
    inputs:
      TARGET_BRANCH:
        description: "The target branch"
        default: ""
        type: string

jobs:
  schemathesis-Testting:
    if: github.event.inputs.POC_ENV == 'schemathesis'
    name: OpenAPI Linting Testting
    environment: building_variables
    runs-on: [poc]
    steps:
    - uses: schemathesis/action@v1
      with:
        schema: "./one-schema/json_schema/ErrorCode.schema"
        base-url: 'http://json-schema.org/draft-04/schema#'
  openapi-spec-validator:
    if: github.event.inputs.POC_ENV == 'openapi-spec-validator'
    name: Building at ECS
    environment: building_variables
    runs-on: [poc]
    steps:
    - name: pre-commit openapi-spec-validator
      run: |
        pre-commit run --all-files
